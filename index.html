<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="imagetoolbar" content="no" />
	<meta name="content-language" content="kr" />
	<meta http-equiv="pragma" content="no-cache" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
	<script type="text/javascript" src="js/runners.js"></script>
	<script type="text/javascript" src="js/runner.js"></script>

	<style>
	body{font-size:12px;}
	.road{background-image:url(images/road.jpg);height:50px;overflow:hidden;}
	.step{background-image:url(images/trace_road.jpg);height:50px;width:0px;float:left;}
	.road img{float:left}
	.rankBg{background-image:url(images/rank_bg.png);height:37px;width:37px; float:left;text-align:center;}
	.rankBg div{padding-top:10px}


	</style>
	<script type="text/javascript">
		$(document).ready(function(){
	
			var heavyImage = new Image();
			heavyImage.src = "images/horse_stop.gif";
			
			var heavyImage1 = new Image();
			heavyImage1.src = "images/rank_bg.png";
	
		});	
	</script>

	<script type="text/javascript">
	<!--
	var interval = null;

	var rank = Array();
	var maxRoad = 1;

	var runSeq = 0;

	var arrRunner = Array();
	
	var arrRunnerKind = ["Horse","Man","Woman","Monkey"];
	
	var arrRunnerName =[
			"메가스타",
			"단독질주",
			"천하대장군",
			"대승돌풍",
			"천리광풍",
			"폭풍가도",
			"비바캐논",
			"경쾌한질주",
			"빅노이즈",
			"비바캐논",
			"스킵러너"			
	];
	
	function setting(){


		maxRoad = $("#stage").width()-100;

		arrRunner = null;
		arrRunner = Array();

		rank = null
		rank = Array();

		if(interval != null)
		clearInterval( interval );

		interval = null;

		$("#stage").html("");

		var cnt = Number( $("#playerCount").val() );

		//var line ="<div id='line"+cnt+"' class='road'><div class='nameBox' style=\"width:50px;float:left;margin-right:10px;padding-top:10px;\" ><input type=\"text\" class=\"nameText\" style=\"width:50px;\"/></div><div class='step'></div><img class='horseImage' src=\"images/horse_stop.gif\" height=37/></div>";

		for(var i=0;i<cnt;i++){
			idx = Math.floor(Math.random()*arrRunnerName.length);
			idx2 = Math.floor(Math.random()*arrRunnerKind.length);
			runnerName = arrRunnerName[idx];
			runnerKind = arrRunnerKind[idx2];

			if(Math.floor(Math.random()*5) == 1)
				arrRunner[i] = new runner(runnerName);
			else
				arrRunner[i] = new runner(runnerName, runnerKind);
			$("#stage").append("<div id='line"+i+"' class='road'><div class='nameBox' style=\"width:50px;float:left;margin-right:10px;padding-top:10px;\" ><input type=\"text\" class=\"nameText\" style=\"width:50px;\" value=\""+runnerName+"\"/></div><div class='step'></div><img id='runnerImage' class='horseImage' src=\"images/"+arrRunner[i].getCharImage()+"\" height=37/></div>");
		}
	}
	
	
	
	
	function startRace(){

		var cnt = Number( $("#playerCount").val() );
		for(var i=0;i<cnt;i++){
			//arrRunner[i] = new runner("lee "+i, "Horse");
			$("#line"+i+" #runnerImage").attr("src", "images/" + arrRunner[i].getRunImage());
console.log(arrRunner[i].getImg().character);
		}

		$("#goRun").hide();

		//$(".horseImage").attr("src","images/horse_run.gif");

		if(interval != null) return;

		interval = setInterval(function(){


			var seq = 0;

			$(".road .step").each(function(){

				if(arrRunner[ seq ].left == null)
					arrRunner[ seq ].left = 0;

				var myPoint = arrRunner[ seq ].left;

				var rnd = Math.floor( Math.random()*100%20 );

				// 꼴지를 위한 보너스
				if(arrRunner[seq].left != 0){

					var my = arrRunner[seq].left;
					var isMin = true;
					for(var i=0;i<arrRunner.length;i++){
						if( my > arrRunner[i].left ) isMin = false;
					}

					if(isMin == true){
						var bonus = Math.floor( Math.random()*1000%20 ) >= 19 ? 30 : rnd ;

						rnd = bonus;
					}

				}



				arrRunner[ seq ].left = myPoint+rnd;

				if(maxRoad <= arrRunner[ seq ].left) arrRunner[ seq ].left = maxRoad;


				if( maxRoad <= arrRunner[ seq ].left ){

					var rankIn = false;

					for(var i=0;i< rank.length;i++){
						if( rank[i] == seq ) rankIn = true;
					}

					if(rankIn == false){
						rank[ rank.length ] = seq;

					}else{
						$(this).animate( {width:maxRoad},100);
					}

				}else{

					$(this).animate( {width:arrRunner[ seq ].left},100);
				}

				seq ++;

			});


			if( rank.length == $(".road").length ){

				clearInterval( interval );

				interval = null;
				
				for(var i=0;i< rank.length;i++){
					$("#line"+i+" #runnerImage").attr("src","images/" + arrRunner[ i ].getStopImage());
				}


				setTimeout(function(){

				for(var i=0;i< rank.length;i++){

					var rankBox = $("<div>").addClass("rankBg");

					rankBox.append($("<div>").text( i+1 ));

					$(".road").eq( rank[i] ).append(rankBox);
				}

				var message = "경기결과 : \n\n";

				for(var i=0;i< rank.length;i++){

					message += (i+1)+"위 : "+$(".nameText:eq("+rank[i]+")").val()+" \n";
				}

				message += "\n\n Sseq:"+runSeq;


				$("#goRun").show();

				alert(message);

				},1000);
			}




			runSeq ++;

		},100);


}


	//-->
	</script>




	<title> new document </title>

 </head>
 <body>

<div>

	플레이어수 : <input type="text" id="playerCount"/> <button type="button" onclick="setting();">설정완료</button>

</div>


<div id="stage">



</div>
<center><button type="button" onclick="startRace()" id="goRun">달려라!!!</button></center>



 </body>
</html>
